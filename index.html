<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AAC Symbiont Web</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Blokada zaznaczania tekstu i zoomowania dla wrażenia "Appki" */
        body { touch-action: manipulation; user-select: none; -webkit-user-select: none; overscroll-behavior: none; }
        .btn-press:active { transform: scale(0.95); transition: transform 0.1s; }
    </style>
</head>
<body class="bg-gray-900 h-screen w-screen flex flex-col p-2 gap-2 overflow-hidden">

    <div id="display" class="bg-gray-800 text-white text-4xl md:text-6xl font-bold rounded-lg flex items-center justify-center p-4 h-32 border-2 border-gray-600 shadow-lg text-center break-words">
        ...
    </div>

    <div class="grid grid-cols-7 gap-1 flex-grow">
        </div>

    <div class="flex gap-2 h-24 mt-2">
        <button onclick="addSpace()" class="flex-grow bg-gray-600 active:bg-gray-500 text-white text-2xl font-bold rounded shadow btn-press">ODSTĘP</button>
        <button onclick="backspace()" class="w-1/4 bg-red-800 active:bg-red-700 text-white text-2xl font-bold rounded shadow btn-press">USUŃ</button>
        <button onclick="speak()" class="w-1/4 bg-green-700 active:bg-green-600 text-white text-2xl font-bold rounded shadow btn-press">MÓW</button>
    </div>

    <div class="flex justify-between items-center text-gray-500 text-xs px-1">
        <span>v2.0 Web</span>
        <button onclick="downloadLogs()" class="underline hover:text-gray-300">Pobierz Historię</button>
    </div>

<script>
    // --- KONFIGURACJA ---
    const alphabet = "AĄBCĆDEĘFGHIJKLŁMNŃOÓPQRSŚTUVWXYZŻŹ";
    let currentText = "";
    const display = document.getElementById('display');
    const grid = document.querySelector('.grid');

    // --- INICJALIZACJA KLAWIATURY ---
    alphabet.split('').forEach(char => {
        const btn = document.createElement('button');
        btn.innerText = char;
        btn.className = "bg-blue-700 active:bg-blue-600 text-white text-2xl md:text-4xl font-bold rounded shadow btn-press h-full w-full";
        btn.onclick = () => addChar(char);
        grid.appendChild(btn);
    });

    // --- LOGIKA ---
    function updateDisplay() {
        display.innerText = currentText === "" ? "..." : currentText;
    }

    function addChar(char) {
        currentText += char;
        updateDisplay();
    }

    function addSpace() {
        currentText += " ";
        updateDisplay();
    }

    function backspace() {
        currentText = currentText.slice(0, -1);
        updateDisplay();
    }

    // --- MOWA I LOGOWANIE ---
    function speak() {
        if (!currentText) return;

        // 1. Mowa
        const utterance = new SpeechSynthesisUtterance(currentText);
        utterance.lang = 'pl-PL';
        utterance.rate = 0.9; // Nieco wolniej dla wyraźności
        window.speechSynthesis.speak(utterance);

        // 2. Logowanie do pamięci
        saveLog(currentText);
    }

    // --- SYSTEM LOGÓW (LocalStorage) ---
    function saveLog(text) {
        const logs = JSON.parse(localStorage.getItem('aac_logs') || "[]");
        const timestamp = new Date().toLocaleString('pl-PL');
        logs.push(`[${timestamp}] ${text}`);
        localStorage.setItem('aac_logs', JSON.stringify(logs));
    }

    function downloadLogs() {
        const logs = JSON.parse(localStorage.getItem('aac_logs') || "[]");
        if (logs.length === 0) {
            alert("Brak historii rozmów.");
            return;
        }
        
        const blob = new Blob([logs.join('\n')], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `historia_aac_${new Date().toISOString().slice(0,10)}.txt`;
        a.click();
    }

    // Blokada zoomowania (double tap)
    document.addEventListener('dblclick', function(event) {
        event.preventDefault();
    }, { passive: false });
</script>
</body>
</html>
